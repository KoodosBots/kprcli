(()=>{"use strict";!function(){if(!window.__AI_FORM_FILLER_INJECTED__){window.__AI_FORM_FILLER_INJECTED__=!0;class t{constructor(){this.setupFormDetection(),this.setupDOMObserver(),this.detectExistingForms()}setupFormDetection(){document.addEventListener("submit",t=>{const e=t.target;this.analyzeFormSubmission(e)},!0),document.addEventListener("input",t=>{const e=t.target;e.form&&this.trackInputChange(e)},!0)}setupDOMObserver(){this.observer=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;"FORM"===e.tagName?this.analyzeNewForm(e):e.querySelectorAll("form").forEach(t=>this.analyzeNewForm(t))}})})}),this.observer.observe(document.body,{childList:!0,subtree:!0})}detectExistingForms(){const t=document.querySelectorAll("form"),e=Array.from(t).map(t=>this.analyzeFormStructure(t));e.length>0&&this.sendToContentScript("FORM_DETECTED",{forms:e})}analyzeFormStructure(t){const e=this.extractFormFields(t),n=this.extractValidationRules(t),i=this.findSubmitButtons(t);return{id:t.id||this.generateFormId(t),action:t.action,method:t.method,enctype:t.enctype,fields:e,validation:n,submitButtons:i,position:this.getElementPosition(t),isVisible:this.isElementVisible(t)}}extractFormFields(t){const e=[],n=t.elements;for(let t=0;t<n.length;t++){const i=n[t];if("submit"===i.type||"button"===i.type)continue;const o={name:i.name,id:i.id,type:i.type,tagName:i.tagName.toLowerCase(),label:this.getFieldLabel(i),placeholder:i.placeholder,required:i.required,pattern:i.pattern,minLength:i.minLength,maxLength:i.maxLength,min:i.min,max:i.max,step:i.step,autocomplete:i.autocomplete,className:i.className,selector:this.generateUniqueSelector(i),position:this.getElementPosition(i),isVisible:this.isElementVisible(i)};if("select"===i.tagName.toLowerCase()){const t=i;o.options=Array.from(t.options).map(t=>({value:t.value,text:t.text,selected:t.selected}))}e.push(o)}return e}extractValidationRules(t){const e=[],n=document.querySelector("script");return n&&n.textContent&&[/validate\s*\(/,/validation\s*:/,/rules\s*:/,/required\s*:/].forEach(t=>{t.test(n.textContent)&&e.push({type:"client_side_validation",pattern:t.source})}),e}findSubmitButtons(t){const e=[];return t.querySelectorAll('input[type="submit"]').forEach(t=>{e.push({type:"input",value:t.value,selector:this.generateUniqueSelector(t)})}),t.querySelectorAll("button").forEach(t=>{"submit"!==t.type&&t.type||e.push({type:"button",text:t.textContent?.trim(),selector:this.generateUniqueSelector(t)})}),e}getFieldLabel(t){if(t.id){const e=document.querySelector(`label[for="${t.id}"]`);if(e)return e.textContent?.trim()||""}const e=t.closest("label");if(e)return e.textContent?.replace(t.value,"").trim()||"";let n=t.previousElementSibling;for(;n;){if(n.textContent?.trim())return n.textContent.trim();n=n.previousElementSibling}return t.getAttribute("aria-label")||t.title||""}generateUniqueSelector(t){if(t.id)return`#${t.id}`;const e=[];let n=t;for(;n&&n!==document.body;){let t=n.tagName.toLowerCase();if(n.className){const e=n.className.split(" ").filter(t=>t.trim());e.length>0&&(t+="."+e.join("."))}const i=Array.from(n.parentElement?.children||[]).filter(t=>t.tagName===n.tagName);i.length>1&&(t+=`:nth-of-type(${i.indexOf(n)+1})`),e.unshift(t),n=n.parentElement}return e.join(" > ")}generateFormId(t){const e=t.action||window.location.href,n=t.elements.length;return`form_${btoa(e).slice(0,8)}_${n}`}getElementPosition(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height}}isElementVisible(t){const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity}analyzeNewForm(t){const e=this.analyzeFormStructure(t);this.sendToContentScript("NEW_FORM_DETECTED",{form:e})}analyzeFormSubmission(t){const e=this.analyzeFormStructure(t),n=this.extractSubmissionData(t);this.sendToContentScript("FORM_SUBMITTED",{form:e,submission:n})}extractSubmissionData(t){const e=new FormData(t),n={};return e.forEach((t,e)=>{n[e]=t}),{data:n,timestamp:(new Date).toISOString(),url:window.location.href}}trackInputChange(t){this.sendToContentScript("INPUT_CHANGED",{field:{name:t.name,type:t.type,value:t.value.length,selector:this.generateUniqueSelector(t)},timestamp:(new Date).toISOString()})}sendToContentScript(t,e){window.postMessage({type:t,data:e,source:"ai-form-filler-injected"},"*")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new t):new t}}()})();